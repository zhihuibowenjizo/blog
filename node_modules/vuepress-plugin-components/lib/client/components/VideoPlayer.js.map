{"version":3,"file":"VideoPlayer.js","sources":["../../../src/client/components/VideoPlayer.ts"],"sourcesContent":["import {\n  computed,\n  defineComponent,\n  h,\n  onBeforeMount,\n  onMounted,\n  ref,\n} from \"vue\";\n\nimport type { UseMediaTextTrackSource } from \"@vueuse/core\";\nimport type { Options as PlyrOptions } from \"plyr\";\nimport type { PropType, VNode } from \"vue\";\n\nimport \"plyr/dist/plyr.css\";\nimport \"../styles/video-player.scss\";\n\nexport default defineComponent({\n  name: \"VideoPlayer\",\n\n  props: {\n    /** Options object for plyr config. **/\n    options: {\n      type: Object as PropType<PlyrOptions>,\n      default: () => ({}),\n    },\n\n    /**\n     * Video source\n     *\n     * 视频源\n     */\n    src: {\n      type: String,\n      required: true,\n    },\n\n    /**\n     * Video title\n     *\n     * 视频标题\n     */\n    title: {\n      type: String,\n      default: \"A video\",\n    },\n\n    /**\n     * Video file type\n     *\n     * 视频文件类型\n     */\n    type: {\n      type: String,\n      default: \"\",\n    },\n\n    /**\n     * Video tracks\n     *\n     * 视频字幕\n     */\n    tracks: {\n      type: Array as PropType<UseMediaTextTrackSource[]>,\n      default: (): UseMediaTextTrackSource[] => [],\n    },\n\n    /**\n     * Video poster\n     *\n     * 视频封面\n     */\n    poster: {\n      type: String,\n      default: \"\",\n    },\n\n    /**\n     * Component width\n     *\n     * 组件宽度\n     */\n    width: {\n      type: [String, Number],\n      default: \"100%\",\n    },\n\n    /**\n     * Whether to loop the video\n     *\n     * 是否循环播放\n     */\n    loop: Boolean,\n  },\n\n  setup(props) {\n    let player: Plyr | null = null;\n    const video = ref<HTMLVideoElement>();\n\n    const plyrOptions = computed(() => ({\n      hideYouTubeDOMError: true,\n      ...props.options,\n    }));\n\n    onMounted(() => {\n      void import(\"plyr\").then(({ default: Plyr }) => {\n        if (video.value) player = new Plyr(video.value, plyrOptions.value);\n      });\n    });\n\n    onBeforeMount(() => {\n      try {\n        player?.destroy();\n      } catch (err: unknown) {\n        if (\n          !(\n            plyrOptions.value.hideYouTubeDOMError &&\n            (<Error>err).message ===\n              \"The YouTube player is not attached to the DOM.\"\n          )\n        )\n          console.error(err);\n      }\n    });\n\n    return (): VNode | null =>\n      props.src\n        ? h(\n            \"div\",\n            {\n              class: \"video-wrapper\",\n              style: {\n                width: props.width,\n              },\n            },\n            [\n              h(\"a\", { class: \"sr-only\", href: props.src }, props.title),\n              h(\n                \"video\",\n                {\n                  ref: video,\n                  title: props.title,\n                  crossorigin: \"anonymous\",\n                  poster: props.poster,\n                  preload: \"metadata\",\n                  controls: \"\",\n                  ...(props.loop ? { loop: \"\" } : {}),\n                },\n                [\n                  ...props.tracks.map((track) => h(\"track\", track)),\n                  h(\"source\", { src: props.src, type: props.type }),\n                ]\n              ),\n            ]\n          )\n        : null;\n  },\n});\n"],"names":["VideoPlayer","defineComponent","props","player","video","ref","plyrOptions","computed","onMounted","Plyr","onBeforeMount","err","h","track"],"mappings":"qKAgBA,IAAAA,EAAeC,EAAgB,CAC7B,KAAM,cAEN,MAAO,CAEL,QAAS,CACP,KAAM,OACN,QAAS,KAAO,CAClB,EAAA,EAOA,IAAK,CACH,KAAM,OACN,SAAU,EACZ,EAOA,MAAO,CACL,KAAM,OACN,QAAS,SACX,EAOA,KAAM,CACJ,KAAM,OACN,QAAS,EACX,EAOA,OAAQ,CACN,KAAM,MACN,QAAS,IAAiC,EAC5C,EAOA,OAAQ,CACN,KAAM,OACN,QAAS,EACX,EAOA,MAAO,CACL,KAAM,CAAC,OAAQ,MAAM,EACrB,QAAS,MACX,EAOA,KAAM,OACR,EAEA,MAAMC,EAAO,CACX,IAAIC,EAAsB,KAC1B,MAAMC,EAAQC,EAAsB,EAE9BC,EAAcC,EAAS,KAAO,CAClC,oBAAqB,GACrB,GAAGL,EAAM,OACX,EAAE,EAEF,OAAAM,EAAU,IAAM,CACT,OAAO,QAAQ,KAAK,CAAC,CAAE,QAASC,CAAK,IAAM,CAC1CL,EAAM,QAAOD,EAAS,IAAIM,EAAKL,EAAM,MAAOE,EAAY,KAAK,EACnE,CAAC,CACH,CAAC,EAEDI,EAAc,IAAM,CAClB,GAAI,CACFP,GAAA,MAAAA,EAAQ,QACV,CAAA,OAASQ,EAAT,CAGML,EAAY,MAAM,qBACVK,EAAK,UACX,kDAGJ,QAAQ,MAAMA,CAAG,CACrB,CACF,CAAC,EAEM,IACLT,EAAM,IACFU,EACE,MACA,CACE,MAAO,gBACP,MAAO,CACL,MAAOV,EAAM,KACf,CACF,EACA,CACEU,EAAE,IAAK,CAAE,MAAO,UAAW,KAAMV,EAAM,GAAI,EAAGA,EAAM,KAAK,EACzDU,EACE,QACA,CACE,IAAKR,EACL,MAAOF,EAAM,MACb,YAAa,YACb,OAAQA,EAAM,OACd,QAAS,WACT,SAAU,GACV,GAAIA,EAAM,KAAO,CAAE,KAAM,EAAG,EAAI,EAClC,EACA,CACE,GAAGA,EAAM,OAAO,IAAKW,GAAUD,EAAE,QAASC,CAAK,CAAC,EAChDD,EAAE,SAAU,CAAE,IAAKV,EAAM,IAAK,KAAMA,EAAM,IAAK,CAAC,CAClD,CACF,CACF,CACF,EACA,IACR,CACF,CAAC"}